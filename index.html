<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <script src='https://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.css' rel='stylesheet' />
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <title>delimited | Three.js Maps</title>
    <style>
      text {
        fill: white;
      }
      #mapContainer {
        margin: 100px;
        background-color: #333;
        width: 80%;
        height: 500px;
      }
      #tooltip {
        opacity: .9;
        background: #333;
        padding: 5px;
        border: 1px solid lightgrey;
        border-radius: 5px;
        position: absolute;
        z-index: 10;
        visibility: hidden;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <div id="intro">
      <h3>D3 Maps in Three.js</h3>
    </div>
    <div id="loading">
      <h5>Loading...</h5>
    </div>
    <div id="container"></div>
    <div id="menu"></div>
    <div id="icons">
      <img src="css/img/single.png">
      <img src="css/img/pinch.png">
      <img src="css/img/triple.png">
    </div>
    <div id="mapContainer"></div>
    <script src="lib/three.min.js"></script>
    <script src="lib/tween.js"></script>
    <script src="lib/CSS3DRenderer.js"></script>
    <script src="lib/TrackballControls.js"></script>
    <script src="lib/d3.min.js"></script>
    <script src="js/viz.js"></script>
    <script>
      d3.json("data/religions.json", function (error, data) {
        console.log(data);

        var leafletMap = L.mapbox.map('mapContainer', 'delimited.ho6391dg')
            .setView([33, 0], 2);

      var featureLayer = L.geoJson(data,  {
            style: getStyle,
            onEachFeature: onEachFeature
        }).addTo(leafletMap);

      /*
      var featureLayer = L.mapbox.featureLayer(data)
          .setFilter(function() { return true; })
          .setStyle(style)
          .addTo(leafletMap);

*/

      function getStyle (feature) {
        console.log("feature", feature);
        return {
            fillColor: feature.properties.data ? "#E3CF57": "#00C957",
            weight: 1,
            opacity: 1,
            color: 'blue',
            dashArray: '3',
            fillOpacity: .6
        };
      }

      function onEachFeature (feature, layer) {
        layer.on({
            mouseover: highlightFeature,
            mouseout: mouseout,
            click: zoomToFeature
        });
      }

      function highlightFeature (e) {
        var layer = e.target;

        layer.setStyle({
            weight: 2,
            color: 'grey',
            dashArray: '',
            fillOpacity: 0.3
        });
        if (!L.Browser.ie && !L.Browser.opera) {
            layer.bringToFront();
        }
      }

      function mouseout(e) {
          featureLayer.resetStyle(e.target);
      }

      function zoomToFeature(e) {
          leafletMap.fitBounds(e.target.getBounds());
      }


        window.mapper = featureLayer;
        console.log(featureLayer);
        /*VIZ.drawElements(data);
        VIZ.transform('helix');
        d3.select("#loading").remove();
        VIZ.render();
        VIZ.animate();
        */window.addEventListener('resize', VIZ.onWindowResize, false);
      });
    </script>
  </body>
</html>